CC=g++
ANTLR_SEARCH_PATHS=-I grammar/antlr/include -I grammar/antlr/libantlr3c
LEXER_SEARCH_PATH=-I grammar/output
CPP_FILES := $(wildcard *.cpp)
OBJ_FILES := $(addprefix obj/,$(notdir $(CPP_FILES:.cpp=.o)))
H_FILES = $(wildcard *.h)
OBJECTS = ${CPP_FILES:.cpp=.o}
ARGS=-std=c++0x
CCFLAGS = -std=c++0x


all: $(CPP_FILES) antlr malice 

# Main MAlice target
malice: $(OBJ_FILES)
	$(CC) $(CCFLAGS) $(ANTLR_SEARCH_PATHS) $(LEXER_SEARCH_PATH) grammar/antlr/libantlr3c/.libs/libantlr3c.a -o compile $^
	
obj/%.o: %.cpp
	$(CC) $(CCFLAGS) $(ANTLR_SEARCH_PATHS) $(LEXER_SEARCH_PATH) -c -o $@ $<


# Building the lexer and parser generated by ANTLR
antlr: 
	sh ./configureantlr.sh

malice_lexer: antlr
	$(CC) $(ANTLR_SEARCH_PATHS) -c grammar/output/MAliceLexer.c

malice_parser: antlr
	$(CC) $(ANTLR_SEARCH_PATHS) -c grammar/output/MAliceParser.c



clean:
	@sh ./cleanantlr.sh
.PHONY: clean
