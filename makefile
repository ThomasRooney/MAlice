CC=g++
ANTLR_SEARCH_PATHS=-I grammar/antlr/include -I grammar/antlr/libantlr3c
LEXER_SEARCH_PATH=-I grammar/output
HEADER_SEARCH_PATHS=-I src $(LEXER_SEARCH_PATH) $(ANTLR_SEARCH_PATHS)
CPP_FILES := $(wildcard src/*.cpp)
OBJ_FILES := $(addprefix obj/,$(notdir $(CPP_FILES:.cpp=.o)))
H_FILES = $(wildcard src/*.h)
OBJECTS = ${CPP_FILES:.cpp=.o}
CCFLAGS = -std=c++0x -O3


all:  compile
	
obj/%.o: src/%.cpp obj/MAliceLexer.o obj/MAliceParser.o grammar/output/MAliceLexer.c grammar/output/MAliceParser.c
	$(CC) $(CCFLAGS) $(HEADER_SEARCH_PATHS) -c $< -o $@ 

compile: $(OBJ_FILES) $(ANTLR_OUTPUT_FILES) obj/MAliceLexer.o obj/MAliceParser.o antlr
	$(CC) $(CCFLAGS) $(OBJ_FILES) obj/MAliceLexer.o obj/MAliceParser.o grammar/antlr/libantlr3c/.libs/libantlr3c.a -o $@

# Building the lexer and parser generated by ANTLR
antlr: 
	sh ./configureantlr.sh

obj/MAliceLexer.o: antlr grammar/output/MAliceLexer.h grammar/output/MAliceLexer.c
	$(CC) $(CCFLAGS) $(HEADER_SEARCH_PATHS) -c grammar/output/MAliceLexer.c -o obj/MAliceLexer.o

obj/MAliceParser.o: antlr grammar/output/MAliceParser.h grammar/output/MAliceParser.c
	$(CC) $(CCFLAGS) $(HEADER_SEARCH_PATHS) -c grammar/output/MAliceParser.c -o obj/MAliceParser.o



clean:
	@sh ./cleanantlr.sh
	rm obj/*.o
.PHONY: clean
